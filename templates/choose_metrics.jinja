<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Metrics - SAFS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
</head>

<body class="p-4 text-bg-light">

    <header class="d-flex justify-content-center">
        <h1>Choose Metrics</h1>
    </header>
    <section id="base-directory-section">
        <form action="{{ url_for('choose_metrics') }}" method="post">
            <div class="col">
                <label for="base-directory" class="form-label">
                    <h2>Choose Base Directory:</h2>
                </label>
                <input type="text" id="base-directory" class="form-control mb-3" name="base-directory"
                    value="{{ base_directory }}" required>
                <button type="submit" class="btn btn-primary">Get Metrics</button>
            </div>
            {% if base_dir_error %}
            <div class="alert alert-danger mt-3" role="alert">
                {{ base_dir_error }}
            </div>
            {% endif %}
            <input type="text" name="config-file" value="{{ config_file }}" hidden>
        </form>
    </section>

    {% if base_directory and not base_dir_error %}
    <section id="config-file-section" class="mt-4">
        <form action="{{ url_for('choose_metrics') }}" method="post">
            <div class="col">
                <label for="config-file" class="form-label">
                    <h2>Choose Optional Config File:</h2>
                </label>
                <input type="text" id="config-file" class="form-control mb-3" name="config-file"
                    value="{{ config_file }}">
                <button type="submit" class="btn btn-primary">Get Config File Data</button>
            </div>
            {% if config_file_error %}
            <div class="alert alert-danger mt-3" role="alert">
                {{ config_file_error }}
            </div>
            {% endif %}
            <input type="text" name="base-directory" value="{{ base_directory }}" hidden>
        </form>
    </section>
    {% else %}
    <input type="text" name="config-file" value="{{ config_file }}" hidden>
    {% endif %}


    {% if grouped_metrics %}
    <section id="metrics-section" class="mt-4">
        <form action="{{ url_for('choose_metrics') }}" method="post">
            <h2>Metrics:</h2>
            <div class="accordion mb-3" id="accordion">
                {%for metric_group, metric_list in grouped_metrics.items() %}
                <div class="accordion-item">
                    <h3 class="accordion-header">
                        <button id="{{ metric_group }}-but" class="accordion-button text-bg-secondary collapsed"
                            type="button" data-bs-toggle="collapse" data-bs-target="#{{ metric_group }}"
                            aria-expanded="false" aria-controls="{{ metric_group }}">
                            {{ metric_group }}
                        </button>
                    </h3>
                    <div id="{{ metric_group }}" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            <div class="row">
                                <ul class="list-group">
                                    {% if config_data %}
                                    {% for metric in metric_list %}
                                    <li class="list-group-item text-bg-light">
                                        {% if metric in config_data[metric_group] %}
                                        <input id="{{ metric }}" class="form-check-input me-1" type="checkbox"
                                            name="{{ metric }}" value="{{ metric }}" checked>
                                        <script>
                                            var metric_group_but = document.getElementById("{{ metric_group }}-but");
                                            metric_group_but.classList.remove("collapsed");
                                            metric_group_but.ariaExpanded = "true";
                                            document.getElementById("{{ metric_group }}").classList.add("show");
                                        </script>
                                        {% else %}
                                        <input id="{{ metric }}" class="form-check-input me-1" type="checkbox"
                                            name="{{ metric }}" value="{{ metric }}">
                                        {% endif %}
                                        <label class="form-check-label stretched-link" for="{{ metric }}">
                                            {{ metric }}
                                        </label>
                                    </li>
                                    {% endfor %}
                                    {% else %}
                                    {% for metric in metric_list %}
                                    <li class="list-group-item text-bg-light">
                                        <input id="{{ metric }}" class="form-check-input me-1" type="checkbox"
                                            name="{{ metric }}" value="{{ metric }}">
                                        <label class="form-check-label stretched-link" for="{{ metric }}">
                                            {{ metric }}
                                        </label>
                                    </li>
                                    {% endfor %}
                                    {% endif %}
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="col">
                <label for="output-config-file" class="form-label">
                    <h2>Choose Output Config File:</h2>
                </label>
                <input type="text" id="output-config-file" class="form-control mb-3" name="output-config-file"
                    value="{{ output_config_file }}">
                <button type="submit" class="btn btn-primary">Save Config Data</button>
            </div>

            <input type="text" name="base-directory" value="{{ base_directory }}" hidden>
            <input type="text" name="config-file" value="{{ config_file }}" hidden>
        </form>
    </section>
    {% endif %}
    </form>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
        crossorigin="anonymous"></script>
</body>

</html>